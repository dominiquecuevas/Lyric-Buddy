<!DOCTYPE html>
<html>
<head>
    <title></title>

<!-- Load jQuery -->
<script src="http://code.jquery.com/jquery-latest.js"></script>

<!-- Load jQuery.selection plugin-->
<script type="text/javascript" src="static/jquery.selection.js"></script>

</head>
<body>

    <form id="searchForm">
        <input id="searchTerm" type="text"><br>
        <input id="search" type="submit" value="Search">
    </form>

    <h1>Results</h1>

    <iframe id="ytplayer" type="text/html" width="640" height="360"
    src="https://www.youtube.com/embed/{{ video_url }}?autoplay=1"
    frameborder="0"></iframe>

    <h2 id="title">{{ song_title }}</h2>
    <h3 id="artist">{{ artist }}</h3>
    <p id="lyrics">
        <!-- jinja block to pass through html code -->
        {% autoescape false %}
        {{ lyrics_html }}
        {% endautoescape %}
    </p>

    <p>
    <!-- while text selected, click button to  -->
    <input type="button" id="get-fragment" value="Get song fragment" />
    </p>

    <div id="annotation">
    <form action="/save" method="POST">
    Fragment <textarea id="fragment" name='fragment'></textarea><br>
    Annotation <textarea name='annotation'></textarea><br>
    <input type='hidden' name='song_title' value="{{ song_title }}">
    <input type='hidden' name='song_artist' value="{{ artist }}">
    <input type='hidden' name='lyrics' value="{{ lyrics_html }}">
    <input type='hidden' name='video_url' value="{{ video_url }}">
    <input type='submit' value='Save'>
    </form>

    <table id="q_annotations">
        <th>Fragment</th>
        <th>Annotation</th>
        <!-- append rows from query -->
    </table>
    </div>

    <script>

    // const fragment = $('fragment').attr('value')
    // Get selected text
    // when get-fragment button is clicked, put the selected text in textarea

    $('#get-fragment').on('click', function(){
        $('#lyrics').focus();
        $('#fragment').text($.selection());

    });

    </script>

    <script>
    $('#search').on('click', (evt) => {
        evt.preventDefault();
        // $('#lyrics').html('bye<br>bye<br>');

        $('#q_annotations').append('<tr>test append to table</tr>');

        const q = $('#searchTerm').val();
        $.get(`/api/search?q=${q}`, (res) => {
            $('#lyrics').html(res.lyrics);
            $('input[name="lyrics"]').val(res.lyrics);

            // TODO: do that stuff up there ^^^^ but for everything else :D

            $('#title').html(res.song_title);
            $('input[name="song_title"]').val(res.song_title);

            $('#artist').html(res.song_artist);
            $('input[name="song_artist"]').val(res.song_artist);
            
            $('input[name="video_url"]').val(res.video_url);
            $('iframe').attr('src', `https://www.youtube.com/embed/${res.video_url}?autoplay=0`);

            // get q_annotations from json, is a list of tuples
            // index into tuples, add a row 'tr'
                // have a fragment 'td' and annotation 'td'
            for (const annotation of res.q_annotations)
            $('#q_annotations').append(`<tr><td>${res.q_annotations}</td></tr>`);
        });

    });

    </script>

</body>
</html>